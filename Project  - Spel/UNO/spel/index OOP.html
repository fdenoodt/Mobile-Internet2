<!DOCTYPE>
<html>

<head>
    <title>UNO OOP</title>
    <link href="https://fonts.googleapis.com/css?family=Rammetto+One" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    <link href="style.css" rel="stylesheet" type="text/css">

</head>

<body style="overflow:hidden;">

        <div class="startScherm jumbotron jumbotron-fluid" id="startScherm">
                <h1 class="display-4">UNO</h1>
                <p class="lead" id="resultaten">
                    Welcome to UNO.<br>
                    A remake of the game, created by Fabian Denoodt.
                    <br>

                    <button type="button" class="btn btn-danger" onclick="maakSpelGereed()">Start playing</button>
                </p>
        </div>

    <div class="eindScherm jumbotron jumbotron-fluid" id="eindScherm">
            <h1 class="display-4">Scores</h1>
            <p class="resultaten lead" id="resultaten">
                <br> 1. Fabian
                <br> 2. Bot1
                <br> 3. Bot2
                <br>4. not worth mentioning.<br>
                <button type="button" class="btn btn-danger" onclick="playAgain()">Play again</button>
            </p>
    </div>

    <div id="map">

        <div id="terreinBot1"></div>
        <div id="terreinBot2"></div>
        <div id="terreinBot3"></div>
        <div id="terreinFabian"></div>


    </div>



    <script>
        "use strict";
        var map = document.getElementById("map");
        var stapel = new Array();
        var gebruikteKaarten = new Array();

        var richtingIsKlokWijs = true;

        var zindex = 1;

        var eindScore = new Array();

        function speler(naam, terrein) {
            this.naam = naam;
            this.kaarten = new Array();
            this.terrein = document.getElementById(terrein);
            this.isUitGespeeld = false;
        }

        function kaart(waarde, kleur, idee) {
            this.waarde = waarde;
            this.kleur = kleur;
            this.idee = idee;
        }

        var Fabian = new speler("Fabian", "terreinFabian");
        var bot1 = new speler("Bot1", "terreinBot1");
        var bot2 = new speler("Bot2", "terreinBot2");
        var bot3 = new speler("Bot3", "terreinBot3");

        var wieZijnBeurt = Fabian;

        stapel[0] = new kaart(9, "geel", 1);
        stapel[1] = new kaart(1, "blauw", 2);
        stapel[2] = new kaart(2, "geel", 3);
        stapel[3] = new kaart(3, "rood", 3);
        stapel[4] = new kaart(4, "rood", 4);
        stapel[5] = new kaart(5, "geel", 5);
        stapel[6] = new kaart(6, "geel", 6);
        stapel[7] = new kaart(6, "geel", 7);
        stapel[8] = new kaart(6, "geel", 8);
        stapel[9] = new kaart(6, "geel", 9);
        stapel[10] = new kaart(6, "blauw", 10)
        stapel[11] = new kaart(6, "geel", 11);
        stapel[12] = new kaart(6, "rood", 12);
        stapel[12] = new kaart(6, "groen", 14);

        //startKaart
        gebruikteKaarten[gebruikteKaarten.length] = new kaart(6, "blauw", 13);


        //speler kaarten geven
        Fabian.kaarten[Fabian.kaarten.length] = stapel[stapel.length - 1];
        stapel.pop();
        Fabian.kaarten[Fabian.kaarten.length] = stapel[stapel.length - 1];
        stapel.pop();
        Fabian.kaarten[Fabian.kaarten.length] = stapel[stapel.length - 1];
        stapel.pop();

        bot1.kaarten[bot1.kaarten.length] = stapel[stapel.length - 1];
        stapel.pop();
        bot1.kaarten[bot1.kaarten.length] = stapel[stapel.length - 1];
        stapel.pop();

        bot2.kaarten[bot2.kaarten.length] = stapel[stapel.length - 1];
        stapel.pop();
        bot2.kaarten[bot2.kaarten.length] = stapel[stapel.length - 1];
        stapel.pop();
        bot2.kaarten[bot2.kaarten.length] = stapel[stapel.length - 1];
        stapel.pop();

        bot3.kaarten[bot3.kaarten.length] = stapel[stapel.length - 1];
        stapel.pop();
        bot3.kaarten[bot3.kaarten.length] = stapel[stapel.length - 1];
        stapel.pop();


        function maakSpelGereed() {
            $(".startScherm").fadeOut("slow");
            toonLaatstGezetteKaartEnStapel();
            outputKaartenVanSpelers();
        }



        function toonLaatstGezetteKaartEnStapel() {

            //laatstgezette kaart
            var laatsGezetteKaart = "";
            laatsGezetteKaart += `
                <div id = "${gebruikteKaarten[gebruikteKaarten.length - 1].idee}" class="kaart ${gebruikteKaarten[gebruikteKaarten.length - 1].kleur}" style="left: 0; top: 0px; z-index: ${++zindex}">
                    <div class="binnenKaart">
                        <span class="kaartNr">${gebruikteKaarten[gebruikteKaarten.length - 1].waarde}</span>
                    </div>
                </div>`;

            Fabian.terrein.innerHTML += laatsGezetteKaart;


            //stapel
            Fabian.terrein.innerHTML += `<div id = "${stapel[stapel.length - 1].idee}" onclick="neemKaart()" class="kaart ${stapel[stapel.length - 1].kleur}" style="left: 800; top: 0px;">
                    <div class="binnenKaart">
                        <span class="kaartNr">${stapel[stapel.length - 1].waarde}</span>
                    </div>
                </div>`;
        }

        function outputKaartenVanSpelers() {

            updateKaartenVanFabian();
            updateKaartenVanBots();

            //12.5 omdat aan beide kanten 12.5% niet gebruikt wordt. (in totaal wordt 75% width aan kaarten gegeven)
            //var extraMargin = $(window).width() * (12.5 / 100);
            //var widthKaart = ($(window).width() * (30 / 100)) / 7; //idk why, maar als ik door 8 deel komt in miden.


            //console.log(extraMargin);
            //var plaatsPerKaart = ($(window).width() / 1.5 )  / Fabian.kaarten.length;
            // var plaatsPerKaart = ($(window).width() * (75 / 100)) / Fabian.kaarten.length;
            // for (var i = 0; i < Fabian.kaarten.length; i++) {
            //     map.innerHTML += `
            //     <div class="kaart ${Fabian.kaarten[i].kleur}" style="left: ${(i * plaatsPerKaart) + extraMargin - widthKaart}px; bottom: 0px;">
            //         <div class="binnenKaart">
            //             <span class="kaartNr">${Fabian.kaarten[i].waarde}</span>
            //         </div>
            //     </div>`;
            // }



            // //12.5 omdat aan beide kanten 12.5% niet gebruikt wordt. (in totaal wordt 75% width aan kaarten gegeven)
            // var extraMargin = $(window).width() * (12.5 / 100);
            // var widthKaart = ($(window).width() * (30 / 100)) / 7; //idk why, maar als ik door 8 deel komt in miden.
            // console.log(extraMargin);

            //var plaatsPerKaart = ($(window).width() / 1.5 )  / Fabian.kaarten.length;
            //var plaatsPerKaart = ($(window).width() * (75 / 100)) / Fabian.kaarten.length;


        }



        function updateKaartenVanFabian() {
            var kaartenVanFabian = "";
            for (var i = 0; i < Fabian.kaarten.length; i++) {
                kaartenVanFabian += `
                <div id="${Fabian.kaarten[i].idee}" class="kaart ${Fabian.kaarten[i].kleur}" value="${Fabian.kaarten[i].kleur};${Fabian.kaarten[i].waarde}" style="left: ${(i * 100)}px; bottom: 0px;" onclick="kiesKaart(this)">
                    <div class="binnenKaart">
                        <span class="kaartNr">${Fabian.kaarten[i].waarde}</span>
                    </div>
                </div>`;
            }


            Fabian.terrein.innerHTML += kaartenVanFabian;
        }

        function updateKaartenVanBots() {

            //kaarten Bot1, Bot2, Bot3

            var outputKaartenBot1 = "";
            for (var i = 0; i < bot1.kaarten.length; i++) {
                outputKaartenBot1 += `
                <img id="${bot1.kaarten[i].idee}" src="img/uno_back.png" class="unoKaart" style="transform: rotateZ(90deg); left: 20; top:${(i * 70) + 150};" alt="Afbeelding van de achterkant van een uno kaart">"`;
            }
            bot1.terrein.innerHTML = outputKaartenBot1;

            var outputKaartenBot2 = "";
            for (var i = 0; i < bot2.kaarten.length; i++) {
                outputKaartenBot2 += `
                <img id="${bot2.kaarten[i].idee}" src="img/uno_back.png" class="unoKaart" style="transform: rotateZ(180deg);left: ${(i * 70) + 150}; top:0;" alt="Afbeelding van de achterkant van een uno kaart">"`;
            }
            bot2.terrein.innerHTML = outputKaartenBot2;

            var outputKaartenBot3 = "";
            for (var i = 0; i < bot3.kaarten.length; i++) {
                outputKaartenBot3 += `
                <img id="${bot3.kaarten[i].idee}" src="img/uno_back.png" class="unoKaart" style="transform: rotateZ(-90deg);left: 850; top:${(i * 70) + 150};" alt="Afbeelding van de achterkant van een uno kaart">"`;
            }
            bot3.terrein.innerHTML = outputKaartenBot3;





        }



        function kiesKaart(gegeven) {
            if (wieZijnBeurt != Fabian || Fabian.isUitGespeeld)
                return;

            var id = gegeven.id;
            var selectedKaart;

            var i = 0
            for (i; i < Fabian.kaarten.length; i++) {
                if (Fabian.kaarten[i].idee == id) {
                    console.log(Fabian.kaarten[i] + " is gekozen");
                    selectedKaart = Fabian.kaarten[i];
                    break;
                }
            }


            //if undifined want code moet niet opnieuw uitgevoerd worden als kaart al gelegd is.
            //kaart is undifined als ze niet in object fabian zijn kaarten zit.
            if (selectedKaart != undefined) {

                if (selectedKaart.kleur == gebruikteKaarten[gebruikteKaarten.length - 1].kleur || selectedKaart.waarde == gebruikteKaarten[gebruikteKaarten.length - 1].waarde) {
                    console.log("mag leggen");
                    document.getElementById(id).style.transition = "1s";

                    document.getElementById(id).style.left = 0;
                    document.getElementById(id).style.bottom = $(window).height() - $("#" + id).height();
                    document.getElementById(id).style.zIndex = ++zindex;


                    Fabian.kaarten.splice(i, 1);
                    gebruikteKaarten.push(selectedKaart);
                    kijkOfGewonnenHeeft(Fabian);
                    //z index moet voortdurend gestegen worden.
                    //of anderes door eerst kaart verwijderen en dan toevoegen

                    //dit moet nu al om te vermijden dat gebr 2 keer snel na elkaar legt
                    wieZijnBeurt = bot1;
                    setTimeout(function () { bepaalBeurt(); }, 1500);
                    console.log("timeout");



                }
                else {
                    console.log("mag niet leggen");
                }
            }
        }


        function neemKaart() {
            if (wieZijnBeurt != Fabian)
                return;

            if (stapel.length > 1) {
                Fabian.kaarten.push(stapel[stapel.length - 1]);
                stapel.pop();

                updateKaartenVanFabian();
                toonLaatstGezetteKaartEnStapel();

                wieZijnBeurt = bot1;
                bepaalBeurt();
            }
            else {
                alert("er zijn geen kaarten meer.");
            }

        }




        //*********************************************************************
        //************************Timer****************************************
        //*********************************************************************

        function bepaalBeurt() {

            if (wieZijnBeurt == bot1) {
                botLegtKaart(wieZijnBeurt);
                wieZijnBeurt = bot2;
                console.log(wieZijnBeurt.naam);

                setTimeout(function () {
                    bepaalBeurt();

                }, 500);
            }

            else if (wieZijnBeurt == bot2) {
                botLegtKaart(wieZijnBeurt);
                wieZijnBeurt = bot3;
                console.log(wieZijnBeurt.naam);

                setTimeout(function () {
                    bepaalBeurt();

                }, 500);


            }
            else if (wieZijnBeurt == bot3) {
                botLegtKaart(wieZijnBeurt);
                wieZijnBeurt = Fabian;

                console.log(wieZijnBeurt.naam)

                setTimeout(function () {
                    bepaalBeurt();

                }, 500);

            }

        }


        function botLegtKaart(bot) {
            if (bot.isUitGespeeld)
                return;

            console.log(bot.kaarten);
            var laatsGezetteKaart = gebruikteKaarten[gebruikteKaarten.length - 1];
            console.log("laatsGezetteKaart");
            console.log(laatsGezetteKaart);
            for (var i = 0; i < bot.kaarten.length; i++) {
                if (bot.kaarten[i].kleur == laatsGezetteKaart.kleur || bot.kaarten[i].waarde == laatsGezetteKaart.waarde) {

                    //mag kaart leggen
                    gebruikteKaarten.push(bot.kaarten[i]);

                    bot.kaarten.splice(i, 1);
                    updateKaartenVanBots();
                    toonLaatstGezetteKaartEnStapel();


                    kijkOfGewonnenHeeft(bot);

                    return;
                }

            }

            bot.kaarten.push(stapel[stapel.length - 1]);
            stapel.pop();

            Fabian.terrein.innerHTML = "";
            updateKaartenVanBots();
            updateKaartenVanFabian();
            toonLaatstGezetteKaartEnStapel();
        }


        function kijkOfGewonnenHeeft(speler) {
            if (speler.kaarten.length < 1) {
                speler.isUitGespeeld = true;
                eindScore.push(speler.naam);

                //alert(`${speler.naam} is uit.`);
                setTimeout(toonScore, 100);
            }
        }

        function toonScore() {
            if (eindScore.length >= 3) {
                //alert(`Het spel is afgelopen. Dit waren de scores: 1. ${eindScore[0]}, 2. ${eindScore[1]}, 3. ${eindScore[2]}`);

                $(".resultaten").html(`<span class="resultatenNummer">1.</span> ${eindScore[0]}
                <br> <span class="resultatenNummer">2.</span> ${eindScore[1]}
                <br> <span class="resultatenNummer">3.</span> ${eindScore[2]}
                <br> <span class="resultatenNummer">4.</span> Not worth mentioning.<br>
                <button type="button" class="btn btn-danger" onclick="playAgain()">Play again</button>`);

                $(".eindScherm").fadeIn("slow");

            }
        }

        function playAgain(){
          console.log("De gebruiker wilt opnieuw spelen.");
        }
    </script>
</body>

</html>
